<!DOCTYPE html>
<html>
<head>
  <title>Drive API Quickstart</title>
  <meta charset="utf-8" />
</head>
<body>
  <p>Drive API Quickstart</p>

  <!-- Add buttons to initiate auth sequence and sign out -->
  <button id="authorize_button" onclick="handleAuthClick()">Authorize</button>
  <button id="signout_button" onclick="handleSignoutClick()">Sign Out</button>

  <pre id="content" style="white-space: pre-wrap;"></pre>

  <script type="text/javascript">
    // Set your client ID and API key from the Developer Console
    const CLIENT_ID = '874869339776-fmp7jb9soctgqodhdv0lkun8nnffort5.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyCmR8BmAIGGVXyoB-egVthrSlE-vDzsqtk';
    const FOLDER_ID = '1LlyZ-F9CQb_Bv-9A3Tp9l1YfYTOVxwIT';

    // Discovery doc URL for APIs used by the quickstart
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';

    // Authorization scopes required by the API; multiple scopes can be included, separated by spaces
    const SCOPES = 'https://www.googleapis.com/auth/drive.metadata.readonly';

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;

    // Hide buttons by default
    const authorizeButton = document.getElementById('authorize_button');
    const signoutButton = document.getElementById('signout_button');
    signoutButton.style.visibility = 'hidden'; // Hide signout button by default

    /**
     * Callback after api.js is loaded.
     */
    function gapiLoaded() {
      gapi.load('client', initializeGapiClient);
    }

    /**
     * Callback after the API client is loaded. Loads the
     * discovery doc to initialize the API.
     */
    async function initializeGapiClient() {
      await gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: [DISCOVERY_DOC],
        scope: SCOPES
      });
      gapiInited = true;
      maybeEnableButtons();
    }

    /**
     * Callback after Google Identity Services are loaded.
     */
    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: tokenClientCallback,
      });
      gisInited = true;
      maybeEnableButtons();
    }

    /**
     * Enables user interaction after all libraries are loaded.
     */
    function maybeEnableButtons() {
      if (gapiInited && gisInited) {
        authorizeButton.style.visibility = 'visible'; // Unhide the authorize button
      }
    }

    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick() {
      tokenClient.requestAccessToken({ prompt: 'consent' });
    }

    /**
     *  Sign out the user upon button click.
     */
    function handleSignoutClick() {
      const token = gapi.client.getToken();
      if (token !== null) {
        google.accounts.oauth2.revoke(token.access_token);
        gapi.client.setToken('');
        document.getElementById('content').innerText = '';
        authorizeButton.innerText = 'Authorize';
        signoutButton.style.visibility = 'hidden';
      }
    }

    /**
     * Token client callback function.
     */
    async function tokenClientCallback(resp) {
      if (resp.error !== undefined) {
        console.error('Error:', resp.error);
        return;
      }
      signoutButton.style.visibility = 'visible';
      authorizeButton.innerText = 'Refresh';
      await listFiles();
    }

    /**
     * Print metadata for first 10 files.
     */
    async function listFiles() {
      try {
        const response = await gapi.client.drive.files.list({
          'q': `'${FOLDER_ID}' in parents`,
          'pageSize': 10,
          'fields': 'files(id, name)',
        });
        const files = response.result.files;
        if (!files || files.length === 0) {
          document.getElementById('content').innerText = 'No files found.';
          return;
        }
        let output = 'Files:\n';
        files.forEach((file) => {
          output += `${file.name} (${file.id})\n`;
        });
        document.getElementById('content').textContent = output;
      } catch (error) {
        console.error('Error fetching files:', error);
        document.getElementById('content').innerText = 'Error fetching files. Please try again.';
      }
    }
  </script>
  <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
